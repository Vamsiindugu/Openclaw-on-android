#!/usr/bin/env bash
# patches/systemctl - Termux stub (systemd unavailable)
#
# Intercepts systemctl calls and handles them gracefully on Termux
# For 'restart' commands, triggers openclaw reload via config.patch (SIGUSR1)

set -euo pipefail

for arg in "$@"; do
    case "$arg" in
        restart)
            # Try config.patch reload first (gateway running → SIGUSR1)
            if command -v openclaw &>/dev/null; then
                if ! openclaw gateway config.patch \
                    "{\"meta\":{\"restartNonce\":\"$(date +%s%N)\"}}" \
                    2>/dev/null; then
                    # Gateway not running — start it
                    openclaw gateway 2>/dev/null || true
                fi
            fi
            exit 0
            ;;
        start|stop|enable|disable|status)
            # No-op for other systemctl commands
            exit 0
            ;;
        *)
            # Unknown command, just exit
            exit 0
            ;;
    esac
done

exit 0
